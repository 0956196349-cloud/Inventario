<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TIGO - Inventario + Ventas</title>

  <!-- CSS separado -->
  <link rel="stylesheet" href="./styles.css">
</head>

<body>

  <h1>VENTAS E INVENTARIO</h1>

  <!-- Barra de estado -->
  <div class="statusbar">
    <div id="invStatus" class="badge">Inventario: ...</div>
    <div id="venStatus" class="badge">Ventas: ...</div>
    <button style="max-width:260px" onclick="runHealthChecks()">Revisar estado</button>
  </div>

  <!-- Contenido principal -->
  <div class="row">

    <!-- INVENTARIO -->
    <div class="card">
      <h2>Inventario</h2>
      <button onclick="cargarInventario()">Cargar inventario</button>

      <h3>Crear Item</h3>
      <input id="nombre" placeholder="Nombre (ej: Mouse)">
      <input id="tipo" placeholder="Tipo (ej: entrada)">
      <input id="cantidad" type="number" placeholder="Cantidad (ej: 50)">
      <input id="estado" placeholder="Estado (ej: activo)">

      <button onclick="crearItem()">Crear</button>

      <pre id="invOut"></pre>
    </div>

    <!-- VENTAS -->
    <div class="card">
      <h2>Ventas</h2>
      <button onclick="cargarVentas()">Cargar ventas</button>

      <h3>Crear Venta</h3>
      <input id="cliente" placeholder="Cliente (ej: Juan Pérez)">
      <input id="itemId" type="number" placeholder="ID del item (ej: 1)">
      <input id="cantVenta" type="number" placeholder="Cantidad a vender (ej: 2)">

      <button onclick="crearVenta()">Crear venta</button>

      <pre id="venOut"></pre>
    </div>

  </div>

  <p class="hint">
    Inventario y ventas</p>

  <!-- Configuración de URLs + Health -->
  <script src="./health.js"></script>

  <!-- Lógica principal -->
  <script>
    const INV = () => window.API.INVENTARIO_URL;
    const VEN = () => window.API.VENTAS_URL;

    window.addEventListener("load", () => runHealthChecks());

    async function cargarInventario(){
      try{
        const res = await fetch(`${INV()}/inventario/`);
        const data = await res.json();
        document.getElementById("invOut").textContent =
          JSON.stringify(data, null, 2);
      }catch(e){
        document.getElementById("invOut").textContent =
          "Error: no se pudo conectar con Inventario";
        console.error(e);
      }
    }

    async function crearItem(){
      try{
        const payload = {
          nombre: document.getElementById("nombre").value,
          tipo: document.getElementById("tipo").value,
          cantidad: Number(document.getElementById("cantidad").value || 0),
          estado: document.getElementById("estado").value
        };

        const res = await fetch(`${INV()}/inventario/`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        document.getElementById("invOut").textContent =
          JSON.stringify(data, null, 2);
      }catch(e){
        document.getElementById("invOut").textContent =
          "Error al crear item";
        console.error(e);
      }
    }

    async function cargarVentas(){
      document.getElementById("venOut").textContent =
        "Endpoint GET /ventas pendiente o no implementado.";
    }

    async function crearVenta(){
      try{
        const payload = {
          producto_id: Number(document.getElementById("itemId").value),
          cantidad: Number(document.getElementById("cantVenta").value)
        };

        const res = await fetch(`${VEN()}/ventas`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        document.getElementById("venOut").textContent =
          JSON.stringify(data, null, 2);
      }catch(e){
        document.getElementById("venOut").textContent =
          "Error al crear venta";
        console.error(e);
      }
    }
  </script>

</body>
</html>
